import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css               */function C(e){return(e||"").toString().trim().toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"")}function F(e,o){if(!e)return"";const n=e[o];return n?typeof n=="object"&&n?n.t||"":n:""}function q(e,o){if(!e)return"";const n=e[o];return n&&typeof n=="object"&&n&&n.r||""}function K({content:e,getLangKey:o,getSettings:n,onProgress:s}){const t={sceneId:null,stepIndex:0,reputation:0,energy:100,lastResult:null};function c(){return e.scenes.find(r=>r.id===t.sceneId)||null}function a(){const r=c();return r&&r.steps[t.stepIndex]||null}function m(r){t.sceneId=r,t.stepIndex=0,t.lastResult=null,d()}function d(){typeof s=="function"&&s({...t,step:a()})}function B(){t.energy=Math.max(0,t.energy-5)}function h(){t.reputation+=1,t.lastResult={ok:!0}}function f(r){B(),t.lastResult={ok:!1,message:r||"Not quite."}}function p(){t.stepIndex+=1,t.lastResult=null}function G(r){const l=a();if(!l||!l.task||l.task.type!=="mc")return;l.task.correctIndex===r?(h(),l.next==="next"&&p()):f("Wrong choice."),d()}function $(r){const l=a();if(!l||!l.task||l.task.type!=="text")return;const M=o(),W=l.task.expected(M,n()),H=C(r);W.some(O=>C(O)===H)?(h(),l.next==="next"&&p()):f("Try again."),d()}function P(){const r=c();return!!r&&t.stepIndex>=r.steps.length}return{state:t,start:m,currentScene:c,currentStep:a,chooseOption:G,submitText:$,canAdvance:P}}const i=(e,o)=>({t:e,r:o}),u={goodMorning:{en:"Good morning",es:"Buenos días",fr:"Bonjour",pt:"Bom dia",de:"Guten Morgen",it:"Buongiorno",ro:"Bună dimineața",ru:"Доброе утро",ja:i("おはようございます","ohayou gozaimasu"),zh:i("早上好","zǎoshang hǎo"),ar:i("صباح الخير","sabah al-khayr"),he:i("בוקר טוב","boker tov"),el:i("Καλημέρα","kaliméra"),arc:i("ܨܦܪܐ ܛܒܐ","safra taba")},goodNight:{en:"Good night",es:"Buenas noches",fr:"Bonne nuit",pt:"Boa noite",de:"Gute Nacht",it:"Buonanotte",ro:"Noapte bună",ru:"Спокойной ночи",ja:i("おやすみなさい","oyasumi nasai"),zh:i("晚安","wǎn'ān"),ar:i("تصبح على خير","tusbih ala khayr"),he:i("לילה טוב","laila tov"),el:i("Καληνύχτα","kalinýchta"),arc:i("ܠܠܝܐ ܛܒܐ","lelya taba")}},v={scenes:[{id:"homeMorning",title:"Morning at Home",steps:[{id:"gm1",npc:"Family Member",line:"Say “Good morning”.",task:{type:"mc",options:e=>{const o=u.goodMorning[e],n=u.goodNight[e],s=u.goodMorning.es,t=c=>typeof c=="object"?c.t:c;return[t(o),t(n),t(s)]},correctIndex:0},next:"next",teach:{note:"High-frequency greetings appear constantly. Master them early."}},{id:"gm2",npc:"Family Member",line:"Now type it (exact).",task:{type:"text",expected:(e,o)=>{const n=u.goodMorning[e],s=a=>typeof a=="object"?a.t:a,t=a=>typeof a=="object"?a.r:"",c=[s(n)];return o!=null&&o.showRoman&&t(n)&&c.push(t(n)),c}},next:"next",teach:{note:"Typing forces recall. Romanization can be a bridge when needed."}}]},{id:"bedNight",title:"Bedtime",steps:[{id:"gn1",npc:"You",line:"End the day: say “Good night”.",task:{type:"mc",options:e=>{const o=u.goodNight[e],n=u.goodMorning[e],s=u.goodNight.es,t=c=>typeof c=="object"?c.t:c;return[t(o),t(n),t(s)]},correctIndex:0},next:"next",teach:{note:"We’ll expand this into a full day loop (home → city → errands → home)."}}]}]},Y=document.getElementById("langDisp"),J=document.getElementById("repDisp"),Q=document.getElementById("energyDisp"),U=document.getElementById("sceneBadge"),L=document.getElementById("npcName"),R=document.getElementById("npcLine"),S=document.getElementById("taskTitle"),E=document.getElementById("mcArea"),N=document.getElementById("mcOptions"),x=document.getElementById("typeArea"),b=document.getElementById("typeInput"),V=document.getElementById("typeSubmit"),y=document.getElementById("resultBox"),T=document.getElementById("answerMode"),j=document.getElementById("showRoman"),D=document.getElementById("showEnglish"),k=document.getElementById("scenePick"),X=document.getElementById("restartBtn");function I(){return typeof app<"u"&&app.lang?app.lang:"es"}function z(){return{answerMode:T.value,showRoman:j.checked,showEnglish:D.checked}}k.innerHTML=v.scenes.map(e=>`<option value="${e.id}">${e.title}</option>`).join("");function Z(e){const o=I(),n=typeof LANGS<"u"?LANGS.find(t=>t.key===o):null;Y.textContent=n?`${n.flag} ${n.label}`:o,J.textContent=String(e.reputation),Q.textContent=String(e.energy);const s=g.currentScene();U.textContent=s?s.title:"Scene"}function _(e){const o=I(),n=z(),s=g.currentStep();if(y.style.display="none",y.classList.remove("ok","bad"),!s){L.textContent="",R.textContent="Scene complete. Choose another scene from the right.",S.textContent="",E.style.display="none",x.style.display="none";return}L.textContent=s.npc||"";const t=s.id.startsWith("gm")?u.goodMorning:s.id.startsWith("gn")?u.goodNight:null,c=t?F(t,o):"",a=t?q(t,o):"",m=t?t.en:"",d=[];if(d.push(s.line),n.showEnglish&&m&&d.push(`EN: ${m}`),c&&d.push(`Target: ${c}`),n.showRoman&&a&&d.push(`Romanization: ${a}`),R.textContent=d.join("  •  "),S.textContent=n.answerMode==="typing"?"Type your reply":n.answerMode==="both"?"Choose or type your reply":"Choose the best reply",s.task.type==="mc"&&(n.answerMode==="mc"||n.answerMode==="both")){E.style.display="";const B=s.task.options(o);N.innerHTML="",B.forEach((h,f)=>{const p=document.createElement("button");p.type="button",p.className="optBtn",p.textContent=h,p.addEventListener("click",()=>g.chooseOption(f)),N.appendChild(p)})}else E.style.display="none";s.task.type==="text"&&(n.answerMode==="typing"||n.answerMode==="both")||s.task.type==="mc"&&n.answerMode==="both"?x.style.display="":x.style.display="none"}function ee(e){e.lastResult&&(y.style.display="",e.lastResult.ok?(y.classList.add("ok"),y.textContent="Correct. +1 reputation"):(y.classList.add("bad"),y.textContent=`${e.lastResult.message}  (-5 energy)`))}const g=K({content:v,getLangKey:I,getSettings:z,onProgress:e=>{Z(e),_(),ee(e)}});function w(){g.start(k.value)}k.addEventListener("change",w);X.addEventListener("click",w);function A(){const e=b.value;b.value="",g.submitText(e)}V.addEventListener("click",A);b.addEventListener("keydown",e=>{e.key==="Enter"&&A()});[T,j,D].forEach(e=>e.addEventListener("change",()=>g.state&&g.start(g.state.sceneId||k.value)));w();
